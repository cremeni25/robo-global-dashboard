<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Robo Global AI — Dashboard Executivo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      margin: 0;
      font-family: Inter, Arial, sans-serif;
      background: linear-gradient(180deg, #050b1e, #020617);
      color: #e5e7eb;
    }

    header {
      padding: 32px;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    header p {
      margin-top: 6px;
      color: #94a3b8;
    }

    .container {
      padding: 32px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 24px;
    }

    .card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 0 0 1px rgba(148,163,184,0.08);
    }

    .card h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 16px;
      color: #e2e8f0;
    }

    .muted {
      color: #94a3b8;
      font-size: 14px;
    }

    .success { color: #22c55e; }
    .warning { color: #eab308; }
    .error { color: #ef4444; }

    .full {
      grid-column: 1 / -1;
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      margin-top: 8px;
      background: #020617;
      color: #e5e7eb;
    }

    button {
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      background: #2563eb;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }

    footer {
      padding: 24px;
      text-align: center;
      color: #64748b;
      font-size: 13px;
    }
  </style>
</head>

<body>

<header>
  <h1>Robo Global AI</h1>
  <p>Dashboard humano · leitura executiva sob governança</p>
</header>

<section class="container">

  <!-- CAMADA EXECUTIVA -->
  <div class="card">
    <h3>Estado do Robô</h3>
    <div id="estadoRobo">—</div>
    <div class="muted" id="mensagemRobo"></div>
  </div>

  <div class="card">
    <h3>Intenção Atual</h3>
    <div id="intencaoAtual">—</div>
  </div>

  <div class="card">
    <h3>Próxima Ação</h3>
    <div id="proximaAcao">—</div>
    <div class="muted" id="motivoAcao"></div>
  </div>

  <div class="card">
    <h3>Fontes Ativas</h3>
    <ul id="fontesAtivas"></ul>
  </div>

  <!-- ACESSO FINANCEIRO -->
  <div class="card full">
    <h3>Acesso Financeiro (Governança Humana)</h3>
    <div class="muted">Nenhum dado financeiro é exibido sem autorização.</div>
    <input type="password" id="chaveFinanceira" placeholder="Digite a chave financeira humana" />
    <button onclick="liberarFinanceiro()">Desbloquear Financeiro</button>
    <div id="statusFinanceiro" class="muted" style="margin-top:8px;"></div>
  </div>

  <!-- FASE 3 -->
  <div id="fase3" class="container full" style="display:none; padding:0;">

    <div class="card">
      <h3>Visão Financeira Consolidada</h3>
      <div id="visaoFinanceira"></div>
    </div>

    <div class="card">
      <h3>Entradas Financeiras</h3>
      <div id="entradasFinanceiras"></div>
    </div>

    <div class="card">
      <h3>Saídas Financeiras</h3>
      <div id="saidasFinanceiras"></div>
    </div>

    <div class="card">
      <h3>Governança Financeira</h3>
      <div id="governancaFinanceira"></div>
    </div>

  </div>

</section>

<footer>
  Sistema operacional · Leitura humana · Controle final humano
</footer>

<script>
const API = "https://robo-global-api-v2.onrender.com";

async function carregarBasico() {
  const status = await fetch(API + "/dashboard/status").then(r => r.json());
  document.getElementById("estadoRobo").innerText = status.estado_geral;
  document.getElementById("mensagemRobo").innerText = status.mensagem;
  document.getElementById("intencaoAtual").innerText = status.intencao_atual;

  const acao = await fetch(API + "/dashboard/proxima-acao").then(r => r.json());
  document.getElementById("proximaAcao").innerText = acao.proxima_acao;
  document.getElementById("motivoAcao").innerText = acao.motivo;

  const fontes = await fetch(API + "/dashboard/fontes").then(r => r.json());
  const ul = document.getElementById("fontesAtivas");
  fontes.fontes_ativas.forEach(f => {
    const li = document.createElement("li");
    li.innerText = f;
    ul.appendChild(li);
  });
}

async function liberarFinanceiro() {
  const chave = document.getElementById("chaveFinanceira").value;
  const statusEl = document.getElementById("statusFinanceiro");

  try {
    const r = await fetch(API + "/dashboard/fase3/overview", {
      headers: { "X-FINANCEIRO-API-KEY": chave }
    });

    if (r.status === 401 || r.status === 403) {
      statusEl.innerHTML = "<span class='error'>❌ Acesso financeiro negado</span>";
      return;
    }

    const data = await r.json();

    document.getElementById("fase3").style.display = "grid";
    statusEl.innerHTML = "<span class='success'>✔ Acesso financeiro autorizado</span>";

    if (!data.status_financeiro || Object.keys(data.status_financeiro).length === 0) {
      document.getElementById("visaoFinanceira").innerText =
        "Sem dados financeiros consolidados até o momento.";
      document.getElementById("entradasFinanceiras").innerText = "Sem registros.";
      document.getElementById("saidasFinanceiras").innerText = "Sem registros.";
      document.getElementById("governancaFinanceira").innerText = "Sem decisões registradas.";
      return;
    }

    document.getElementById("visaoFinanceira").innerText =
      `Capital atual: ${data.status_financeiro.capital_atual ?? "—"}
Resultado acumulado: ${data.status_financeiro.resultado_acumulado ?? "—"}
Risco atual: ${data.status_financeiro.risco_atual ?? "—"}`;

    document.getElementById("entradasFinanceiras").innerText = "Receitas em análise.";
    document.getElementById("saidasFinanceiras").innerText = "Custos sob controle.";
    document.getElementById("governancaFinanceira").innerText = "Governança ativa.";

  } catch (e) {
    statusEl.innerHTML = "<span class='warning'>⚠ Dados financeiros indisponíveis</span>";
  }
}

carregarBasico();
</script>

</body>
</html>
