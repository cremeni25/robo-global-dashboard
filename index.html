<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Robo Global AI ‚Äî Dashboard Humano</title>

  <style>
    :root {
      --bg: #0f172a;
      --card: #020617;
      --border: #1e293b;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --danger: #ef4444;
      --success: #22c55e;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 600;
    }

    header p {
      margin-top: 6px;
      color: var(--muted);
      font-size: 14px;
    }

    main {
      padding: 24px;
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 16px;
    }

    .value {
      font-size: 15px;
      margin-bottom: 6px;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      margin-top: 8px;
    }

    button {
      margin-top: 10px;
      padding: 10px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: var(--accent);
      color: #020617;
      font-weight: 600;
    }

    .status-ok {
      color: var(--success);
      font-weight: 600;
      margin-top: 8px;
    }

    .status-erro {
      color: var(--danger);
      font-weight: 600;
      margin-top: 8px;
    }

    footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: var(--muted);
    }
  </style>
</head>

<body>

<header>
  <h1>Robo Global AI</h1>
  <p>Dashboard humano ‚Ä¢ leitura executiva sob governan√ßa</p>
</header>

<main>

  <!-- CAMADA 1 -->
  <section class="card">
    <h2>Estado Geral</h2>
    <div class="value" id="estadoGeral">‚Äî</div>
    <div class="muted" id="mensagemEstado"></div>
    <div class="muted" id="intencaoAtual"></div>
  </section>

  <!-- CAMADA 2 -->
  <section class="card">
    <h2>Pr√≥xima A√ß√£o</h2>
    <div class="value" id="proximaAcao">‚Äî</div>
    <div class="muted" id="motivoAcao"></div>
  </section>

  <!-- GOVERNAN√áA -->
  <section class="card">
    <h2>Governan√ßa</h2>
    <ul class="muted">
      <li>Escala apenas com ganho consistente</li>
      <li>Freio autom√°tico em perda cr√≠tica</li>
      <li>Nenhuma recupera√ß√£o por impulso</li>
      <li>Toda decis√£o √© registrada</li>
    </ul>
  </section>

  <!-- üîê FASE 3 ‚Äî GATE HUMANO -->
  <section class="card">
    <h2>FASE 3 ‚Äî Acesso Financeiro</h2>
    <div class="muted">Digite a chave financeira humana:</div>
    <input type="password" id="financeKey" placeholder="FINANCEIRO_API_KEY" />
    <button onclick="liberarFinanceiro()">Desbloquear Financeiro</button>
    <div id="financeStatus"></div>
  </section>

  <!-- üìä FASE 3 ‚Äî FINANCEIRO -->
  <section class="card" id="financeiroCard" style="display:none;">
    <h2>FASE 3 ‚Äî Vis√£o Financeira</h2>
    <div class="value" id="capital"></div>
    <div class="value" id="escala"></div>
    <div class="value" id="plano"></div>
    <div class="muted" id="mensagemFinanceira"></div>
  </section>

</main>

<footer>
  Sistema operacional ‚Ä¢ Leitura humana ‚Ä¢ Controle final humano
</footer>

<script>
  const API = "https://robo-global-api-v2.onrender.com";

  async function getJSON(path, headers = {}) {
    const res = await fetch(API + path, { headers });
    if (!res.ok) throw new Error("Erro " + res.status);
    return res.json();
  }

  async function carregarBase() {
    const s = await getJSON("/dashboard/status");
    document.getElementById("estadoGeral").innerText = s.estado_geral;
    document.getElementById("mensagemEstado").innerText = s.mensagem;
    document.getElementById("intencaoAtual").innerText = s.intencao_atual;

    const p = await getJSON("/dashboard/proxima-acao");
    document.getElementById("proximaAcao").innerText = p.proxima_acao;
    document.getElementById("motivoAcao").innerText = p.motivo;
  }

  async function liberarFinanceiro() {
    const key = document.getElementById("financeKey").value.trim();
    const statusEl = document.getElementById("financeStatus");

    statusEl.innerText = "Validando chave‚Ä¶";
    statusEl.className = "muted";

    try {
      const d = await getJSON(
        "/dashboard/fase3/overview",
        { "X-FINANCEIRO-API-KEY": key }
      );

      document.getElementById("financeiroCard").style.display = "block";
      document.getElementById("capital").innerText =
        "Capital Atual: " + (d.status_financeiro.capital_atual ?? "N/A");
      document.getElementById("escala").innerText =
        "Escala Ativa: " + (d.escala.escala_ativa ?? false);
      document.getElementById("plano").innerText =
        "Plano Ativo: " + (d.plano_ativo.nome_plano ?? "N/A");
      document.getElementById("mensagemFinanceira").innerText =
        d.mensagem ?? "";

      statusEl.innerText = "‚úî Financeiro liberado";
      statusEl.className = "status-ok";

    } catch (e) {
      statusEl.innerText = "‚úñ Acesso financeiro negado";
      statusEl.className = "status-erro";
    }
  }

  carregarBase().catch(console.error);
</script>

</body>
</html>
