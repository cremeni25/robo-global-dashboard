<script>
const API = "https://robo-global-api-v2.onrender.com";  // mant√©m igual

// Fun√ß√£o segura para chamadas √† API
async function call(endpoint, options = {}) {
    try {
        const r = await fetch(`${API}${endpoint}`, {
            method: options.method || "GET",
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json"
            },
            mode: "cors",
            cache: "no-store",
        });

        if (!r.ok) throw new Error("HTTP " + r.status);

        return await r.json();

    } catch (e) {
        console.error("ERRO API:", endpoint, e);
        throw e;
    }
}

// STATUS
async function statusAPI() {
    try {
        const data = await call("/status");
        document.getElementById("status-api").innerHTML =
            `<span class="success">API Online ‚Äî Supabase: ${data.supabase}</span>`;
    } catch {
        document.getElementById("status-api").innerHTML =
            `<span class="error">Erro ao conectar √† API</span>`;
    }
}
statusAPI();

// AN√ÅLISE
async function buscarAnalise() {
    document.getElementById("analise-msg").innerHTML = "Carregando...";
    try {
        const data = await call("/analise");
        document.getElementById("analise-box").textContent = JSON.stringify(data, null, 2);
        document.getElementById("analise-msg").innerHTML =
            `<span class="success">An√°lise atualizada com sucesso.</span>`;
    } catch {
        document.getElementById("analise-msg").innerHTML =
            `<span class="error">Erro ao consultar /analise üõë</span>`;
    }
}

// CICLO
async function rodarCiclo() {
    document.getElementById("ciclo-msg").innerHTML = "Executando...";
    try {
        const data = await call("/rodar-ciclo", { method: "POST" });
        document.getElementById("ciclo-msg").innerHTML =
            `<span class="success">Ciclo executado: ${data.status}</span>`;
    } catch {
        document.getElementById("ciclo-msg").innerHTML =
            `<span class="error">Erro ao executar ciclo</span>`;
    }
}
</script>
