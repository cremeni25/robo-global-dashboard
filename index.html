<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Robo Global AI — Dashboard Humano</title>

<style>
:root {
  --bg: #0b1220;
  --card: #0f172a;
  --border: #1e293b;
  --text: #e5e7eb;
  --muted: #94a3b8;
  --accent: #38bdf8;
  --ok: #22c55e;
  --warn: #facc15;
  --err: #ef4444;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: linear-gradient(180deg, #020617, #020617);
  color: var(--text);
}

header {
  padding: 28px;
  border-bottom: 1px solid var(--border);
}

header h1 {
  margin: 0;
  font-size: 26px;
}

header p {
  margin-top: 6px;
  font-size: 14px;
  color: var(--muted);
}

main {
  padding: 24px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 18px;
}

.card {
  background: radial-gradient(circle at top, #020617, #020617);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 20px;
}

.card h2 {
  margin: 0 0 12px;
  font-size: 16px;
}

.value {
  font-size: 15px;
  margin-bottom: 6px;
}

.muted {
  font-size: 13px;
  color: var(--muted);
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  margin-top: 8px;
}

.ok { background: rgba(34,197,94,.15); color: var(--ok); }
.warn { background: rgba(250,204,21,.15); color: var(--warn); }
.err { background: rgba(239,68,68,.15); color: var(--err); }

button {
  background: var(--accent);
  border: none;
  color: #020617;
  font-weight: 600;
  padding: 10px 14px;
  border-radius: 10px;
  cursor: pointer;
}

input {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #020617;
  color: var(--text);
  margin-bottom: 10px;
}

footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  font-size: 12px;
  color: var(--muted);
}
</style>
</head>

<body>

<header>
  <h1>Robo Global AI</h1>
  <p>Dashboard humano • leitura executiva sob governança</p>
</header>

<main>

<!-- CAMADA 1 -->
<section class="card">
  <h2>Estado Geral</h2>
  <div class="value" id="estadoGeral">—</div>
  <div class="muted" id="mensagemEstado">—</div>
  <div class="badge ok" id="intencaoAtual">—</div>
</section>

<!-- CAMADA 2 -->
<section class="card">
  <h2>Próxima Ação</h2>
  <div class="value" id="proximaAcao">—</div>
  <div class="muted" id="motivoAcao">—</div>
</section>

<section class="card">
  <h2>Governança</h2>
  <ul class="muted">
    <li>Escala apenas com ganho consistente</li>
    <li>Freio automático em perda crítica</li>
    <li>Nenhuma recuperação por impulso</li>
    <li>Toda decisão é registrada</li>
  </ul>
</section>

<!-- FASE 3 — AUTENTICAÇÃO -->
<section class="card">
  <h2>FASE 3 — Acesso Financeiro</h2>
  <input type="password" id="chaveFinanceira" placeholder="Digite a chave financeira humana" />
  <button onclick="desbloquearFinanceiro()">Desbloquear Financeiro</button>
  <div class="muted" id="statusAuth"></div>
</section>

<!-- FASE 3 — VISÃO FINANCEIRA -->
<section class="card">
  <h2>FASE 3 — Visão Financeira</h2>

  <div class="value">Capital Atual: <strong id="capitalAtual">—</strong></div>
  <div class="value">Resultado Acumulado: <strong id="resultado">—</strong></div>
  <div class="value">Risco Atual: <strong id="risco">—</strong></div>

  <div class="badge" id="statusFinanceiro">Aguardando leitura</div>

  <p class="muted" id="leituraEstrategica">Aguardando autenticação financeira.</p>
</section>

</main>

<footer>
Sistema operacional • Leitura humana • Controle final humano
</footer>

<script>
const API = "https://robo-global-api-v2.onrender.com";
let FIN_KEY = null;

async function api(path, key) {
  const res = await fetch(API + path, {
    headers: {
      "X-FINANCEIRO-API-KEY": key
    }
  });
  if (!res.ok) throw new Error("Acesso negado");
  return res.json();
}

async function carregarBase() {
  const s = await fetch(API + "/dashboard/status").then(r => r.json());
  const a = await fetch(API + "/dashboard/proxima-acao").then(r => r.json());

  document.getElementById("estadoGeral").innerText = s.estado_geral;
  document.getElementById("mensagemEstado").innerText = s.mensagem;
  document.getElementById("intencaoAtual").innerText = s.intencao_atual;

  document.getElementById("proximaAcao").innerText = a.proxima_acao;
  document.getElementById("motivoAcao").innerText = a.motivo;
}

async function desbloquearFinanceiro() {
  const key = document.getElementById("chaveFinanceira").value;
  if (!key) return;

  try {
    const d = await api("/dashboard/fase3/status", key);
    FIN_KEY = key;

    document.getElementById("statusAuth").innerText = "✔ Acesso financeiro liberado";

    document.getElementById("capitalAtual").innerText = "R$ " + d.capital_atual.toFixed(2);
    document.getElementById("resultado").innerText = "R$ " + d.resultado_acumulado.toFixed(2);
    document.getElementById("risco").innerText = d.risco_atual;

    let badge = document.getElementById("statusFinanceiro");
    let leitura = document.getElementById("leituraEstrategica");

    if (d.resultado_acumulado > 0) {
      badge.className = "badge ok";
      badge.innerText = "Financeiramente saudável";
      leitura.innerText = "O robô apresenta resultado positivo e pode evoluir com cautela.";
    } else if (d.resultado_acumulado < 0) {
      badge.className = "badge err";
      badge.innerText = "Atenção financeira";
      leitura.innerText = "Resultado negativo identificado. Escala deve ser bloqueada.";
    } else {
      badge.className = "badge warn";
      badge.innerText = "Neutro";
      leitura.innerText = "Sem histórico suficiente para decisão de escala.";
    }

  } catch (e) {
    document.getElementById("statusAuth").innerText = "❌ Acesso financeiro negado";
  }
}

carregarBase();
</script>

</body>
</html>
